<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      NFV Acceleration (Part 2) &middot; GalSagie
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">
  <link rel="stylesheet" href="/public/font-awesome/css/font-awesome.min.css">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body>

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p><img src="http://galsagie.github.io/public/img/my_image.jpg" alt="MyImage" width="200" height="200" /></p>
    <p>My blog about everything related to SDN, NFV, Virtualization and Cloud</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/">Home</a>

    

    
    
      
        
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/about/">About</a>
        
      
    
      
        
          <a class="sidebar-nav-item" href="/archive/">Site Archives</a>
        
      
    
      
        
          <a class="sidebar-nav-item" href="/categories/">Post Categories</a>
        
      
    
      
    
      
        
          <a class="sidebar-nav-item" href="/tags/">Content Tags</a>
        
      
    
    
  </nav>
  
   <div class="sidebar-item">
    <p>
      <a href="https://github.com/GalSagie"><i class="fa fa-github fa-3x"></i></a>
      <a href="https://twitter.com/GalSagie"><i class="fa fa-twitter fa-3x"></i></a>
      <a href="https://www.linkedin.com/pub/gal-sagie/14/1ab/577"><i class="fa fa-linkedin-square fa-3x"></i></a>
      <a href="http://galsagie.github.io/feed.xml"><i class="fa fa-rss fa-3x"></i></a>
    </p>
  </div>

  <div class="sidebar-item">
    <p>
      &copy; 2015. All rights reserved.
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">GalSagie</a>
            <small>A blog about network virtualization and cloud</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="post">
  <h1 class="post-title">NFV Acceleration (Part 2)</h1>
  <span class="post-date">25 Jan 2015</span>
  <p>In a <a href="http://galsagie.github.io/sdn/nfv/virtualization/2015/01/21/nfv-acceleration/">previous post of this series</a> i wrote about accelarating virtual functions using networking user space drivers, Intel&#39;s DPDK is one main example but others exists just as well.</p>

<p>In this post i am going to concentrate on by passing host layers and HW offloading, all meant to improve performance and use &quot;standard&quot; hardware to ease some bottlenecks in virtualized environments and networking functions.</p>

<h2>Passthrough and SR-IOV</h2>

<p>It is possible to directly assign a host&#39;s PCI network device to a guest. One prerequisite for doing this assignment is that the host must support either the Intel VT-d or AMD IOMMU extensions. 
Doing this bypass the hypervisor and other switching processing done inside the host and hence improve the networking
performance of the guest (the virtual appliance).</p>

<p>There are two methods of setting up assignment of a PCI device to a guest:</p>

<h3>Standard Passthrough</h3>

<p>This assignment allows virtual machines exclusive access to PCI devices for a range of tasks, and allows PCI devices to appear and behave as if they were physically attached to the guest operating system.
Basically exclusively assigning a NIC port to a VM.</p>

<h3>SR-IOV</h3>

<p>SRIOV network cards provide multiple &quot;Virtual Functions&quot; (VF) that can each be individually assigned to a guest using PCI device assignment, and each will behave as a full physical network device. This permits many guests to gain the performance advantage of direct PCI device assignment, while only using a single slot on the physical machine.</p>

<p>Following is a picture that explains SR-IOV with Intel&#39;s DPDK</p>

<p><img src="http://www.dpdk.org/doc/guides/_images/fast_pkt_proc.png" /></p>

<p>In the picture you can see that each VM has a VF that is identified by a separate VLAN id, what the NIC does is switch the packets into RX queues depending on the VLAN.
There is also a PF that is attached to the virtual switch demonstrating we can use SR-IOV with conjunction to &quot;standard&quot; virtual switching deployments.</p>

<p>You can read more about SR-IOV in <a href="http://blog.scottlowe.org/2009/12/02/what-is-sr-iov/">this detailed post blog.</a></p>

<p>It is clear that out of the two passthrough options, SR-IOV is much more flexible, however still has some disadvantages:</p>

<p>One clear disadvantage is the ability to configure the virtual function in a different way between the VM&#39;s (which might be of different tenants).
Think what happens if one of the VM&#39;s want to change the interface admin status.
Another disadvantage is the fact that SR-IOV still doesn&#39;t support live-migration of VM&#39;s (as far as i know) which is a key feature in virtualized environments.
But probably the major problem is still the lack of full support for SR-IOV in management and orchestration solutions for SDN and NFV.</p>

<p>SR-IOV can currently switch packets into VF&#39;s using L2 data (MAC address/VLAN) but i believe we are going to see much more flexible options coming soon when NIC&#39;s start offloading tunneling data (for example switching according to VXLAN).</p>

<p>Rather or not SR-IOV become a standard in NFV deployments is a good questions, i think it really depends on the performance gap compared to other more flexible and software based solutions.</p>

<h2>HW Offloading</h2>

<p>HW offloading is a big terminology which probably deserve at least its own post (if not many more).
What i mean in our context is the ability of standard networking NIC&#39;s to offload all sort of functions that are else done in software and hence free more CPU cycles for the actual application.</p>

<p>Virtual appliances can leverage HW offloading to increase their performance, few examples:</p>

<ul>
<li><p>Filtering - NIC&#39;s support the ability to define specific/wildcard filtering on header information up to L4 (for example Intel&#39;s Flow Director).
This feature can help in implementing firewall and DPI functions.
Future NIC&#39;s might be able to achieve more than just L4 filters.</p></li>
<li><p>Receive Side Scaling (RSS) - 
This feature allows a NIC to load balance traffic between different cores by hashing the traffic and splitting it into different RX queues.
Few instances of the same VNF can poll different RX queues and process packets simultaneously.
in DPDK you can retrieve the hash result (Toeplitz hash) on the packet meta data and use it in internal flow table implementation (instead of re-calculating hash again). </p></li>
<li><p>Tunneling Encapsulation/Decapsulation - 
Using the NIC to parse protocols and tunnels (VXLAN, NVGRE, VLANS) which are extensively used in virtualized environments. </p></li>
<li><p>TCP Segmentation Offload and Large Receive Offload - 
These two have great benefit for physical standard networking, offloading sequence numbering and packet header creation to the NIC (usually combined with checksum offloading as well) free CPU cycles from the networking stack / network function.</p></li>
</ul>

<p>STT (which is an overlay tunnel protocol used in Nicira&#39;s SDN solution) leverage TCP Segmentation offload capabilities.</p>

<p>TSO is also useful for virtualization environments; TSO is a subset of the more generic segment offload (GSO) on Linux.
With virtio it is possible to receive GSO packets as well as send them. This feature is negotiated between the guest and host.</p>

<p>The idea is that between guests they can exchange jumbo (64K) packets even with
a smaller MTU. This helps in many ways. One example is only a single
route lookup is needed</p>

<p>Dont worry if you didnt understand all the various features i just described, the intention was to give you a sense of what is currently possible with standard NIC&#39;s and how it can be used.
I do plan on dwelling on each of these subjects later in this series and understand specific use cases ,limitations and correct implementation.</p>

<p>In the next post of this series i am going to describe some commercial solutions that combines all the topics we discussed about and more.
We are going to see software offerings from 6Wind and Windriver to accelerate NFV and achieve carrier grade deployments with standard software and devices, and a very interesting hardware offerings that fits into the NFV/SDN world like EZchip and Tilera.</p>

<p>Stay tuned..</p>

  <span class="post-date">Tags:
    
    


  <a href="http://galsagie.github.io/tags/#DPDK">DPDK</a>
  
    &middot;
  

  <a href="http://galsagie.github.io/tags/#HW Offloading">HW Offloading</a>
  
    &middot;
  

  <a href="http://galsagie.github.io/tags/#NFV">NFV</a>
  
    &middot;
  

  <a href="http://galsagie.github.io/tags/#Passthrough">Passthrough</a>
  
    &middot;
  

  <a href="http://galsagie.github.io/tags/#SDN">SDN</a>
  
    &middot;
  

  <a href="http://galsagie.github.io/tags/#SR-IOV">SR-IOV</a>
  
    &middot;
  

  <a href="http://galsagie.github.io/tags/#STT">STT</a>
  
    &middot;
  

  <a href="http://galsagie.github.io/tags/#TSO">TSO</a>
  



  </span>
  
    <span class="post-date">
    &larr; Previous Post: <a href="/sdn/oam/virtualization/2015/01/23/topology-visibility/">Topology Visibility in Virtualized Environments</a></span>
  
  

  <span class="post-sharing"><p>Be social and share this post!<br />

<a href="https://www.facebook.com/sharer/sharer.php?u=http://galsagie.github.io/sdn/nfv/virtualization/2015/01/25/nfv-acceleration-2/" title="Share on Facebook"><i class="fa fa-facebook-square fa-2x"></i></a> 
<a href="https://twitter.com/intent/tweet?text=http://galsagie.github.io/sdn/nfv/virtualization/2015/01/25/nfv-acceleration-2/" title="Share on Twitter"><i class="fa fa-twitter-square fa-2x"></i></a> 
<a href="https://plus.google.com/share?url=http://galsagie.github.io/sdn/nfv/virtualization/2015/01/25/nfv-acceleration-2/" title="Share on Google Plus"><i class="fa fa-google-plus-square fa-2x"></i></a></p></span>
</div>

<div class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="http://galsagie.github.io/sdn/oam/virtualization/2015/01/23/topology-visibility/">
            Topology Visibility in Virtualized Environments
            <small>23 Jan 2015</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="http://galsagie.github.io/sdn/nfv/virtualization/2015/01/21/nfv-acceleration/">
            NFV Acceleration (Part 1)
            <small>21 Jan 2015</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="http://galsagie.github.io/ovs/virtualization/2015/01/16/ovn-distributed-controller/">
            OVN and Distributed Controller
            <small>16 Jan 2015</small>
          </a>
        </h3>
      </li>
    
  </ul>
</div>

  <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'galsagie'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
 
<!-- Start of StatCounter Code for Default Guide -->
<script type="text/javascript">
var sc_project=10238945; 
var sc_invisible=0; 
var sc_security="ea2d3a16"; 
var scJsHost = (("https:" == document.location.protocol) ?
"https://secure." : "http://www.");
document.write("<sc"+"ript type='text/javascript' src='" +
scJsHost+
"statcounter.com/counter/counter.js'></"+"script>");
</script>
<noscript><div class="statcounter"><a title="shopify visitor
statistics" href="http://statcounter.com/shopify/"
target="_blank"><img class="statcounter"
src="http://c.statcounter.com/10238945/0/ea2d3a16/0/"
alt="shopify visitor statistics"></a></div></noscript>
<!-- End of StatCounter Code for Default Guide --> 

      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script>
      (function(document) {
        var toggle = document.querySelector('.sidebar-toggle');
        var sidebar = document.querySelector('#sidebar');
        var checkbox = document.querySelector('#sidebar-checkbox');

        document.addEventListener('click', function(e) {
          var target = e.target;

          if(!checkbox.checked ||
             sidebar.contains(target) ||
             (target === checkbox || target === toggle)) return;

          checkbox.checked = false;
        }, false);
      })(document);
    </script>
  </body>
</html>
